# 音频文件映射更新工具

## 项目概述

本项目提供了两个脚本，用于重新建立初中英语单词的英式发音和美式发音到对应剑桥发音音频文件的映射。这些脚本通过读取`初中 乱序 绿宝书.txt`文件中的`[sound:xxx]`标签，提取音频文件路径，然后更新数据库中的音频路径字段。

## 脚本说明

### 1. 基础版本 - `update_audio_paths.py`

这是一个简单的脚本，专门用于更新初中英语词汇的音频路径。

**功能**：
- 从TXT文件中提取音频路径
- 更新数据库中的音频路径
- 验证音频文件是否存在

**使用方法**：
```bash
python update_audio_paths.py
```

### 2. 高级版本 - `update_all_audio_paths.py`

这是一个更高级的脚本，支持命令行参数，可以处理不同词书的音频映射，并生成详细报告。

**功能**：
- 支持命令行参数，可以指定词书、音频源文件和音频目录
- 生成详细的更新报告
- 提供更完整的错误处理

**使用方法**：
```bash
python update_all_audio_paths.py [--book 词书名称] [--txt 音频源文件路径] [--media 音频文件目录] [--report]
```

**参数说明**：
- `--book`：词书名称，默认为"初中英语词汇"
- `--txt`：音频源TXT文件路径，默认为"wordlists/junior_high/初中 乱序 绿宝书.txt"
- `--media`：音频文件目录，默认为"wordlists/junior_high/Media"
- `--report`：生成详细报告

## 更新结果

根据最新的更新报告，我们成功更新了初中英语词汇的音频路径：

- **成功更新**：1816 个单词
- **未找到映射**：42 个单词
- **英音文件存在**：1793 个
- **英音文件缺失**：0 个
- **美音文件存在**：1782 个
- **美音文件缺失**：0 个

这表明音频文件映射已经成功建立，并且所有映射的音频文件都存在。对于那些未找到映射的单词（如"dentist"、"essay"等），可能需要手动添加音频文件或使用TTS生成。

## 技术细节

1. **音频路径格式**：`cambridge-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx.mp3`
2. **数据库表结构**：
   - `Words`表包含`audio_path_uk`和`audio_path_us`字段，用于存储音频文件路径
3. **音频文件存储位置**：`wordlists/junior_high/Media/`目录

## 注意事项

1. 脚本只会更新指定词书的单词音频路径。
2. 对于在TXT文件中找不到对应音频路径的单词，脚本会列出这些单词，但不会修改它们在数据库中的音频路径。
3. 脚本会验证更新后的音频路径是否对应到实际存在的文件，如果有缺失的文件，会列出这些文件。

## 未来改进

1. 为未找到映射的单词自动生成TTS音频
2. 支持批量处理多个词书
3. 添加图形用户界面，方便非技术用户使用